# 加拿大驾考APP 数据库结构设计

## 概述

本文档详细描述了加拿大驾考APP的数据库结构设计。该设计采用面向数据编程的理念，确保数据的完整性、一致性和高效查询。

## 核心数据表

### 1. 用户管理模块

#### users（用户表）
- **主要字段**：用户基本信息、登录方式、会员状态、省份选择
- **特殊字段**：
  - `userType`: FREE（免费）、MEMBER（会员）、TRIAL（试用）
  - `province`: AB（阿尔伯塔）、BC（不列颠哥伦比亚）、ON（安大略）
  - `trialEndDate`、`membershipEndDate`: 会员/试用到期时间

#### verification_codes（验证码表）
- **用途**：邮箱/手机验证码管理
- **类型**：注册验证、登录验证、密码重置

### 2. 学习内容模块

#### handbook_chapters（手册章节表）
- **核心功能**：存储驾驶手册的所有章节内容
- **多语言支持**：中文和英文内容
- **权限控制**：`isFree` 字段控制免费/付费章节
- **依赖关系**：`prerequisiteChapters` 定义学习顺序

#### reading_records（阅读记录表）
- **功能**：跟踪用户的阅读进度
- **详细记录**：阅读位置、时间消耗、完成状态

#### bookmarks（书签表）
- **功能**：用户可以在任意位置添加书签和备注

### 3. 测验系统模块

#### questions（题目表）
- **题目类型**：
  - `SINGLE_CHOICE`: 单选题
  - `MULTIPLE_CHOICE`: 多选题
  - `TRUE_FALSE`: 判断题
- **多语言支持**：题目和解释的中英文版本
- **难度分级**：1-5级难度系统

#### question_options（题目选项表）
- **功能**：存储每个题目的所有选项
- **正确答案标记**：`isCorrect` 字段

#### quiz_sessions（测验会话表）
- **测验类型**：
  - `CHAPTER`: 章节练习
  - `SIMULATION`: 模拟考试
  - `WRONG_QUESTIONS`: 错题练习
- **成绩记录**：分数、用时、通过状态

#### user_answers（用户答题记录表）
- **详细记录**：每道题的答题情况、耗时、正确性

### 4. 学习进度模块

#### chapter_progress（章节进度表）
- **综合进度**：阅读进度 + 练习成绩
- **统计数据**：练习次数、最高分、平均分
- **解锁机制**：`isUnlocked` 控制章节访问权限

#### wrong_questions（错题本表）
- **错题管理**：记录用户的错误答案
- **复习追踪**：错误次数、是否已掌握
- **智能推荐**：基于错题频率推荐复习

#### learning_stats（学习统计表）
- **全局统计**：总学习时间、答题数量、正确率
- **成就系统**：连续学习天数记录
- **考试统计**：模拟考试次数和通过率

### 5. 系统管理模块

#### feedback（反馈表）
- **反馈类型**：BUG、功能请求、投诉、改进建议
- **状态管理**：待处理、进行中、已解决、已关闭
- **技术信息**：设备信息、APP版本

#### invite_codes（邀请码表）
- **功能**：邀请码系统，提供试用期
- **使用限制**：最大使用次数、过期时间
- **追踪功能**：创建者和使用者记录

#### app_configs（应用配置表）
- **系统配置**：可动态调整的应用参数
- **客户端配置**：`isPublic` 控制哪些配置对客户端可见

#### notifications（通知表）
- **通知类型**：系统通知、学习提醒、测验通知
- **交互功能**：点击跳转、过期时间

#### app_versions（版本管理表）
- **版本控制**：iOS/Android版本管理
- **更新策略**：强制更新、版本说明

## 数据关系设计

### 核心关系链
1. **用户 → 学习进度 → 章节内容**
2. **章节 → 题目 → 选项**
3. **用户 → 测验会话 → 答题记录**
4. **错误答案 → 错题本 → 复习推荐**

### 权限控制链
1. **省份选择 → 相应题库**
2. **会员状态 → 章节解锁**
3. **前置章节 → 后续章节解锁**

## 性能优化考虑

### 索引策略
- 用户ID相关的所有外键
- 章节顺序查询
- 测验类型和时间范围查询
- 题目难度和标签查询

### 数据分区
- 按省份分区存储相关数据
- 按时间分区存储历史记录

### 缓存策略
- 章节内容缓存
- 用户进度缓存
- 应用配置缓存

## 数据完整性

### 级联删除
- 用户删除时级联删除所有相关记录
- 章节删除时处理相关题目和进度

### 约束检查
- 邮箱和手机号唯一性
- 分数范围验证
- 时间逻辑验证

## 扩展性设计

### 多省份支持
- 枚举类型便于添加新省份
- 表结构支持省份特定的题目和规则

### 多语言支持
- 所有用户可见内容都有英文对应字段
- 支持动态语言切换

### 业务扩展
- 可轻松添加新的测验类型
- 支持新的用户状态类型
- 灵活的配置系统支持新功能

## 数据安全

### 敏感信息保护
- 密码哈希存储
- 个人信息加密
- 验证码过期机制

### 审计日志
- 重要操作时间戳记录
- 用户行为跟踪
- 系统配置变更记录

这个数据结构设计充分考虑了加拿大驾考APP的所有业务需求，同时保持了良好的扩展性和维护性。 